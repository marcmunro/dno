<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 3. Getting Started</title>
<link rel="stylesheet" type="text/css" href="dno.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.2">
<link rel="home" href="index.html" title="Dno (0.7.4) User Guide">
<link rel="up" href="index.html" title="Dno (0.7.4) User Guide">
<link rel="prev" href="ch02.html" title="Chapter 2. Installing And Updating Arduino Toolsets">
<link rel="next" href="ch04.html" title="Chapter 4. A Little Exploration">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 3. Getting Started</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="ch02.html">Prev</a> </td>
<th width="60%" align="center"> </th>
<td width="20%" align="right"> <a accesskey="n" href="ch04.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter">
<div class="titlepage"><div><div><h1 class="title">
<a name="idm226"></a>Chapter 3. Getting Started</h1></div></div></div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="getting_started"></a>3.1. Creating The Project Directory</h2></div></div></div>
<p>
      Create a directory named after your project.  For our example,
      we'll call our project <span class="quote">“<span class="quote">blink</span>”</span>.
      </p>
<pre class="programlisting">
~$ mkdir blink
~$ cd blink	    
      </pre>
<p>
    </p>
<p>
      That's it.  It's no harder than that.  But to make this section
      more interesting, let's run <code class="literal">dno</code> in this
      directory:
      </p>
<pre class="programlisting">
blink$ dno
make: Nothing to be done for 'unknown'.
blink$
      </pre>
<p>
    </p>
<p>
      Here dno can't figure out what the right thing to do is, so
      does nothing.  Which is the right thing to do.
    </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm237"></a>3.2. Create An Initial Sketch</h2></div></div></div>
<p>
      Let's create a copy of the much-used
      <code class="literal">blink.ino</code> sketch.  You can use your favourite
      editor, or get it from github, or whatever.  You could even copy
      and paste it from below:
      </p>
<pre class="programlisting">
/*
  Blink

  Turns an LED on for one second, then off for one second, repeatedly.

  Most Arduinos have an on-board LED you can control. On the UNO, MEGA and ZERO
  it is attached to digital pin 13, on MKR1000 on pin 6. LED_BUILTIN is set to
  the correct LED pin independent of which board is used.
  If you want to know what pin the on-board LED is connected to on your Arduino
  model, check the Technical Specs of your board at:
  https://www.arduino.cc/en/Main/Products

  modified 8 May 2014
  by Scott Fitzgerald
  modified 2 Sep 2016
  by Arturo Guadalupi
  modified 8 Sep 2016
  by Colby Newman

  This example code is in the public domain.

  http://www.arduino.cc/en/Tutorial/Blink
*/

// the setup function runs once when you press reset or power the board
void setup() {
  // initialize digital pin LED_BUILTIN as an output.
  pinMode(LED_BUILTIN, OUTPUT);
}

// the loop function runs over and over again forever
void loop() {
  digitalWrite(LED_BUILTIN, HIGH);   // turn the LED on (HIGH is the voltage level)
  delay(1000);                       // wait for a second
  digitalWrite(LED_BUILTIN, LOW);    // turn the LED off by making the voltage LOW
  delay(1000);                       // wait for a second
}
      </pre>
<p>
    </p>
<p>
      Now our directory looks like this:
      </p>
<pre class="programlisting">
blink$ ls
blink.ino
blink$ 
      </pre>
<p>
    </p>
<p>
      Let's run <code class="literal">dno</code> again:
      </p>
<pre class="programlisting">
blink$ dno
Nothing to be done here (in /home/user/proj/blink).
Try dno ./BOARD_TYPE or dno tests
blink$ 
      </pre>
<p>
    </p>
<p>
      This tells us that dno does not know what sort of Arduino board
      to build for.  You can get more information about this using
      <code class="literal">dno info</code> or <code class="literal">dno help</code>.
    </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm250"></a>3.3. Select Our Board</h2></div></div></div>
<p>
      We can tell dno what sort of board to build for by creating a
      <code class="literal">BOARD_TYPE</code> file.  The simplest way to do this
      is using dno's <code class="literal">BOARD_TYPE</code> <a class="link" href="ch04.html#targets" title='4.1.2. Dno "Commands" Are make "Targets"'>target</a>.
    </p>
<p>
      To see what boards are available use <code class="literal">dno
      show_boards</code>.
    </p>
<p>
      Let's assume that we want to compile for a 3.3V Arduino pro
      mini.  Using <code class="literal">show_boards</code>, we find that that
      the board name for this is <span class="quote">“<span class="quote">pro</span>”</span>, and that there
      are 4 cpu options:
      </p>
<pre class="programlisting">
blink$ dno show_boards BOARD=pro

    Supported ArduinoBoard and CPU Types
============================================================
pro                   Arduino Pro or Pro Mini
  16MHzatmega168        ATmega168 (5V, 16 MHz)
  8MHzatmega168         ATmega168 (3.3V, 8 MHz)
  16MHzatmega328        ATmega328P (5V, 16 MHz)
  8MHzatmega328         ATmega328P (3.3V, 8 MHz)
blink$
      </pre>
<p>
    </p>
<p><a name="create_board_type"></a>
      We create our <code class="literal">BOARD_TYPE</code> file as follows:
      </p>
<pre class="programlisting">
blink$ dno BOARD_TYPE BOARD=pro CPU=8MHzatmega328
  Creating BOARD_TYPE...
blink$ ls
blink.ino  BOARD_TYPE
blink$ 
      </pre>
<p>
    </p>
<p>
      We can see that dno has created a BOARD_TYPE file, which
      identifies the type of board that we are to compile for.
      Looking at it:
      </p>
<pre class="programlisting">
blink$ cat BOARD_TYPE
pro.8MHzatmega328
blink$ 
      </pre>
<p>
    </p>
<p>
      We see that it simply contains the board and cpu identification
      for our pro mini board.
    </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm268"></a>3.4. Compiling/Building</h2></div></div></div>
<p>
      Let's now run <code class="literal">dno</code> again and see what happens:
      </p>
<pre class="programlisting">
blink$ dno
  Creating BOARD_INFO...
  C++  [.] blink.ino
  AS  [core] wiring_pulse.S
  C  [core] wiring_shift.c
  C  [core] wiring_pulse.c
  C  [core] wiring_digital.c
  C  [core] wiring.c
  C  [core] wiring_analog.c
  C  [core] WInterrupts.c
  C  [core] hooks.c
  C++  [core] WString.cpp
  C++  [core] WMath.cpp
  C++  [core] USBCore.cpp
  C++  [core] Tone.cpp
  C++  [core] Stream.cpp
  C++  [core] Print.cpp
  C++  [core] PluggableUSB.cpp
  C++  [core] new.cpp
  C++  [core] main.cpp
  C++  [core] IPAddress.cpp
  C++  [core] HardwareSerial.cpp
  C++  [core] HardwareSerial3.cpp
  C++  [core] HardwareSerial2.cpp
  C++  [core] HardwareSerial1.cpp
  C++  [core] HardwareSerial0.cpp
  C++  [core] CDC.cpp
  C++  [core] abi.cpp
  AR [libcore] abi.o...
  LD blink.ino.o
  OBJCOPY (hex) blink.elf
blink$ ls -l
total 28
-rw-r--r-- 1 user user  1233 Jan  6 11:04 blink.ino
-rw-r--r-- 1 user user 12701 Jan  6 12:15 BOARD_INFO
-rw-r--r-- 1 user user    18 Jan  6 12:04 BOARD_TYPE
drwxr-xr-x 3 user user  4096 Jan  6 12:15 build
blink$ 
      </pre>
<p>
    </p>
<p>
      From dno's output we can see that <code class="literal">BOARD_INFO</code>
      was created, and then a bunch of compilation and other commands
      were executed.  In addition to compiling the sketch
      <code class="literal">blink.ino</code>, the components of the
      <code class="literal">core</code> library were built, an archive file was
      built from those components (<code class="literal">AR</code>), the whole
      thing was linked together to create an executable
      (<code class="literal">LD</code>), and then, finally, a downloadable
      version of the executable was created
      (<code class="literal">OBJCOPY</code>).
    </p>
<p>
      Note thet the dno output shows a sanitised version of what is
      actually being done.  This is mainly for aesthetic reasons:
      showing the full commands that are executed is pretty ugly.  But
      if that's what you want, you can (as shown <a class="link" href="ch04.html#VERBOSE">here</a>) set <code class="literal">VERBOSE</code> on
      the command line: 
      </p>
<pre class="programlisting">
blink$ dno VERBOSE=y
      </pre>
<p>
    </p>
<p>
      From our directory listing we can also see that a
      <code class="literal">build</code> directory was created.  This is where
      all of our object, lib and executable files are created:
      </p>
<pre class="programlisting">
blink$ ls -l build
total 372
-rwxr-xr-x 1 user user  14108 Jan  6 12:15 blink.elf
-rw-r--r-- 1 user user   2615 Jan  6 12:15 blink.hex
-rw-r--r-- 1 user user   1104 Jan  6 12:15 blink.ino.d
-rw-r--r-- 1 user user   3860 Jan  6 12:15 blink.ino.o
drwxr-xr-x 2 user user   4096 Jan  6 12:15 libcore
-rw-r--r-- 1 user user 345554 Jan  6 12:15 libcore.a
blink$ ls build/libcore
abi.d		   HardwareSerial.o  Stream.d	       wiring.o
abi.o		   hooks.d	     Stream.o	       wiring_pulse.d
CDC.d		   hooks.o	     Tone.d	       wiring_pulse.o
CDC.o		   IPAddress.d	     Tone.o	       wiring_pulse.S.d
HardwareSerial0.d  IPAddress.o	     USBCore.d	       wiring_pulse.S.o
HardwareSerial0.o  main.d	     USBCore.o	       wiring_shift.d
HardwareSerial1.d  main.o	     WInterrupts.d     wiring_shift.o
HardwareSerial1.o  new.d	     WInterrupts.o     WMath.d
HardwareSerial2.d  new.o	     wiring_analog.d   WMath.o
HardwareSerial2.o  PluggableUSB.d    wiring_analog.o   WString.d
HardwareSerial3.d  PluggableUSB.o    wiring.d	       WString.o
HardwareSerial3.o  Print.d	     wiring_digital.d
HardwareSerial.d   Print.o	     wiring_digital.o
blink$ 
      </pre>
<p>
    </p>
<p>
      Note that once everything is built, dno will not rebuild it
      unless something changes:
      </p>
<pre class="programlisting">
blink$ dno
make: Nothing to be done for 'build'.
blink$
      </pre>
<p>
    </p>
<p>
      Note that the message says <code class="literal">make:...</code>.  This is
      because dno is <a class="link" href="ch04.html#dno_is_make" title="4.1. On Being Based On make">implemented using
      <code class="literal">make</code></a>.
    </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="upload"></a>3.5. Uploading To A Board</h2></div></div></div>
<p>
      Now we need to connect our Arduino device to our computer.
      Typically, this is through a USB connection.  Once done, we can
      verify that the device can be seen using <code class="literal">dno
      devices</code>:
      </p>
<pre class="programlisting">
blink$ dno devices
DEVICES: /dev/ttyUSB0
blink$
      </pre>
<p>
    </p>
<p>
      This shows that a serial device is connected to
      <code class="literal">/dev/ttyUSB0</code>.  This is a good sign.
    </p>
<p>
      Now, as long as there is a single device connected, we should be
      able to upload our sketch:
      </p>
<pre class="programlisting">
blink$ dno upload
  Resetting device attached to (/dev/ttyUSB0)...
/usr/local/bin/dno do_upload
make[1]: Entering directory '.../proj/blink'
 
    Uploading blink.hex to /dev/ttyUSB0

avrdude: AVR device initialized and ready to accept instructions

Reading | ################################################## | 100% 0.01s

avrdude: Device signature = 0x1e950f (probably m328p)
avrdude: reading input file "build/blink.hex"
avrdude: writing flash (924 bytes):

Writing | ################################################## | 100% 0.51s

avrdude: 924 bytes of flash written
avrdude: verifying flash memory against build/blink.hex:
avrdude: load data flash data from input file build/blink.hex:
avrdude: input file build/blink.hex contains 924 bytes
avrdude: reading on-chip flash data:

Reading | ################################################## | 100% 0.43s

avrdude: verifying ...
avrdude: 924 bytes of flash verified

avrdude: safemode: Fuses OK (E:00, H:00, L:00)

avrdude done.  Thank you.

make[1]: Leaving directory '.../blink'
blink$ 	
      </pre>
<p>
    </p>
<p>
      Please note that the ridiculous verbosity of this is outside of
      dno's control.
    </p>
</div>
<div class="section">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="idm303"></a>3.6. In Summary</h2></div></div></div>
<p>
      In summary, to create a brand new project, blink, from scratch,
      and upload it to an Arduino board takes only the following steps
      (dno output not shown):
      </p>
<pre class="programlisting">
~$ mkdir blink
~$ cd blink
blink$ [create blink.cpp using your favourite editor]
blink$ dno BOARD_TYPE BOARD=pro CPU=8MHzatmega328
[ . . . ]
blink$ dno
[ . . . ]
blink$ dno upload
[ . . . ]
      </pre>
<p>
    </p>
<p>
      It could hardly be more simple.
    </p>
<p>
      Note that if you were confident that
      <code class="literal">blink.cpp</code> would build without errors, you
      could even omit the build step: ie the step before the upload,
      as <code class="literal">dno upload</code> will automatically realise that
      compilation and linking is needed and will make it happen.
    </p>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="ch02.html">Prev</a> </td>
<td width="20%" align="center"> </td>
<td width="40%" align="right"> <a accesskey="n" href="ch04.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 2. Installing And Updating Arduino Toolsets </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 4. A Little Exploration</td>
</tr>
</table>
</div>
</body>
</html>
